# rd-bedrock-nova ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

> **Amplify Gen2 + Strands Agent + Amazon Bedrock Nova ã‚·ãƒªãƒ¼ã‚º**

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³)
3. [Amplify Gen2 æ§‹æˆ](#amplify-gen2-æ§‹æˆ)
4. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
6. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
7. [ã‚³ã‚¹ãƒˆæ§‹æˆ](#ã‚³ã‚¹ãƒˆæ§‹æˆ)
8. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ç›®çš„

| é …ç›® | å†…å®¹ |
|------|------|
| **What** | Bedrock Nova Series + Strands Agent ã®çµ±åˆæ¤œè¨¼ |
| **Why** | æœ¬ç•ªç’°å¢ƒã«è¿‘ã„å®‰å®šãƒ†ã‚¹ãƒˆç’°å¢ƒã€Amplify Gen2ã«ã‚ˆã‚‹ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯çµ±åˆ |
| **Who** | AI/MLã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒãƒ¼ãƒ  |
| **Goal** | 20-product ã¸ã®æœ¬ç•ªç§»è¡Œåˆ¤æ–­ææ–™ |

### ä¸»è¦æŠ€è¡“è¦ç´ 

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| **Amplify Gen2** | ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ TypeScript é–‹ç™ºåŸºç›¤ |
| **AppSync** | GraphQL API + Subscriptions |
| **Cognito** | èªè¨¼ãƒ»èªå¯ (Email + MFA) |
| **Nova Sonic** | éŸ³å£°èªè­˜ãƒ»è©±è€…è­˜åˆ¥ãƒ»æ„Ÿæƒ…åˆ†æ |
| **Nova Omni** | æ˜ åƒç†è§£ãƒ»æ™‚ç³»åˆ—åˆ†æ |
| **Nova Embeddings** | ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ |
| **Strands Agent** | Tool ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               AMPLIFY GEN2 FULL-STACK                                    â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           FRONTEND LAYER (Next.js 14)                             â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚  Amplify UI     â”‚  â”‚  Data Client    â”‚  â”‚  Storage Client â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  Authenticator  â”‚  â”‚  (GraphQL)      â”‚  â”‚  (S3 Upload)    â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Login/Signup â”‚  â”‚  â€¢ Mutations    â”‚  â”‚  â€¢ uploadData   â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ MFA          â”‚  â”‚  â€¢ Queries      â”‚  â”‚  â€¢ getUrl       â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Dark Theme   â”‚  â”‚  â€¢ Subscriptionsâ”‚  â”‚  â€¢ Presigned    â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚           â”‚                    â”‚                    â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                    â”‚                    â”‚                                  â”‚
â”‚              â–¼                    â–¼                    â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           AMPLIFY BACKEND LAYER                                   â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚    Cognito      â”‚  â”‚    AppSync      â”‚  â”‚           Lambda                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   User Pool     â”‚  â”‚   (GraphQL)     â”‚  â”‚       (Agent Handler)           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Email Auth   â”‚  â”‚  â€¢ ChatMessage  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ MFA (TOTP)   â”‚  â”‚  â€¢ ChatSession  â”‚  â”‚  â”‚   Strands Agent         â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ JWT Tokens   â”‚  â”‚  â€¢ UploadedFile â”‚  â”‚  â”‚                         â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Password     â”‚  â”‚                 â”‚  â”‚  â”‚  â€¢ invokeAgent()        â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    Policy       â”‚  â”‚  Mutations:     â”‚  â”‚  â”‚  â€¢ Tool Orchestration   â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â€¢ invokeAgent  â”‚  â”‚  â”‚  â€¢ Nova Pro Model       â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  Queries:       â”‚  â”‚  â”‚                         â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â€¢ getUploadUrl â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                â”‚                           â”‚                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                      S3 Storage Bucket                                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  uploads/{user_id}/      processed/{user_id}/      shared/                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ images/             â”œâ”€â”€ transcripts/          â”œâ”€â”€ templates/           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ audio/              â”œâ”€â”€ analysis/             â””â”€â”€ assets/              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€ video/              â””â”€â”€ embeddings/                                    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚                                               â”‚
â”‚                                          â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        AWS BEDROCK (AI/ML Models)                                 â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚   Nova Pro      â”‚  â”‚   Nova Sonic    â”‚  â”‚   Nova Omni     â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚   (LLM)         â”‚  â”‚   (Speech)      â”‚  â”‚   (Vision)      â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Chat         â”‚  â”‚  â€¢ éŸ³å£°èªè­˜     â”‚  â”‚  â€¢ ç”»åƒè§£æ     â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Reasoning    â”‚  â”‚  â€¢ è©±è€…è­˜åˆ¥     â”‚  â”‚  â€¢ å‹•ç”»è¦ç´„     â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Tool Use     â”‚  â”‚  â€¢ æ„Ÿæƒ…åˆ†æ     â”‚  â”‚  â€¢ OCR          â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   Nova Multimodal Embeddings        â”‚  â”‚   Bedrock Guardrails               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                     â”‚  â”‚                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ãƒ†ã‚­ã‚¹ãƒˆåŸ‹ã‚è¾¼ã¿                 â”‚  â”‚  â€¢ Content Filtering               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ç”»åƒåŸ‹ã‚è¾¼ã¿                     â”‚  â”‚  â€¢ PII Detection                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ çµ±ä¸€ãƒ™ã‚¯ãƒˆãƒ«ç©ºé–“                 â”‚  â”‚  â€¢ Safety Controls                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Amplify Gen2 æ§‹æˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®šç¾© (`amplify/backend.ts`)

```typescript
const backend = defineBackend({
  auth,      // Cognito User Pool
  data,      // AppSync GraphQL API
  storage,   // S3 Bucket
  agentFunction,  // Lambda (Strands Agent)
});

// IAM Policy: Bedrock InvokeModel
backend.agentFunction.resources.lambda.addToRolePolicy(
  new PolicyStatement({
    actions: ['bedrock:InvokeModel', 'bedrock:InvokeModelWithResponseStream'],
    resources: ['arn:aws:bedrock:*::foundation-model/amazon.nova-*'],
  })
);
```

### èªè¨¼è¨­å®š (`amplify/auth/resource.ts`)

| è¨­å®šé …ç›® | å€¤ |
|----------|-----|
| èªè¨¼æ–¹å¼ | Email |
| MFA | TOTP (Optional) |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | 8æ–‡å­—ä»¥ä¸Šã€å¤§å°è‹±å­—+æ•°å­— |
| ç¢ºèªã‚³ãƒ¼ãƒ‰ | ãƒ¡ãƒ¼ãƒ«é€ä¿¡ |
| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¾©æ—§ | Email Only |

### GraphQL ã‚¹ã‚­ãƒ¼ãƒ (`amplify/data/resource.ts`)

```graphql
# ãƒ¢ãƒ‡ãƒ«
type ChatMessage @model @auth(rules: [{allow: owner}]) {
  sessionId: String!
  role: Role!  # user | assistant | system
  content: String!
  timestamp: AWSDateTime
  metadata: AWSJSON
}

type ChatSession @model @auth(rules: [{allow: owner}]) {
  title: String
  lastMessageAt: AWSDateTime
  messageCount: Int
  status: SessionStatus  # active | archived
}

type UploadedFile @model @auth(rules: [{allow: owner}]) {
  sessionId: String!
  fileName: String!
  fileType: String!
  s3Key: String!
  size: Int
  uploadedAt: AWSDateTime
}

# ã‚«ã‚¹ã‚¿ãƒ æ“ä½œ
type Mutation {
  invokeAgent(sessionId: String!, message: String!, fileKeys: [String]): String
    @function(name: "agent-handler")
}

type Query {
  getUploadUrl(fileName: String!, fileType: String!): UploadUrlResult
    @function(name: "agent-handler")
}
```

### Storage è¨­å®š (`amplify/storage/resource.ts`)

| ãƒ‘ã‚¹ | ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ |
|------|-------------|
| `uploads/{entity_id}/*` | Owner: read, write, delete |
| `processed/{entity_id}/*` | Owner: read |
| `shared/*` | Authenticated: read |

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

### Lambda Agent Handler

```typescript
// amplify/functions/agent/handler.ts

export const handler: AppSyncResolverHandler<any, any> = async (event) => {
  const { fieldName } = event.info;
  const userId = event.identity?.sub;

  switch (fieldName) {
    case 'invokeAgent':
      return handleInvokeAgent(event.arguments, userId);
    case 'getUploadUrl':
      return handleGetUploadUrl(event.arguments, userId);
  }
};
```

### Strands Agent çµ±åˆ

```typescript
// amplify/functions/agent/strands-agent.ts

const TOOLS = [
  { name: 'analyze_image', description: 'ç”»åƒã‚’åˆ†æ' },
  { name: 'transcribe_audio', description: 'éŸ³å£°ã‚’æ–‡å­—èµ·ã“ã—' },
  { name: 'analyze_video', description: 'å‹•ç”»ã‚’åˆ†æ' },
  { name: 'generate_embeddings', description: 'ãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ' },
];

export async function invokeAgent(params: {
  sessionId: string;
  message: string;
  fileKeys?: string[];
}): Promise<string> {
  // Nova Pro ã§ãƒ„ãƒ¼ãƒ«é¸æŠãƒ»å®Ÿè¡Œ
  const response = await bedrockClient.send(
    new InvokeModelCommand({
      modelId: 'amazon.nova-pro-v1:0',
      body: JSON.stringify({
        system: [{ text: systemPrompt }],
        messages,
        toolConfig: { tools: TOOLS },
      }),
    })
  );
  return parseResponse(response);
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. èªè¨¼ãƒ•ãƒ­ãƒ¼

```
User â†’ Amplify Authenticator â†’ Cognito User Pool â†’ JWT Token â†’ AppSync
```

### 2. ãƒãƒ£ãƒƒãƒˆãƒ•ãƒ­ãƒ¼

```
User Input â†’ Data Client â†’ AppSync Mutation (invokeAgent)
                                    â”‚
                                    â–¼
                           Lambda (Agent Handler)
                                    â”‚
                                    â–¼
                           Strands Agent â†’ Bedrock Nova Pro
                                    â”‚
                                    â–¼
                           Tool Execution (Audio/Video/Search)
                                    â”‚
                                    â–¼
                           Response â†’ User
```

### 3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```
User â†’ Storage Client (uploadData) â†’ S3 Bucket (uploads/{user_id}/)
                                           â”‚
                                           â–¼
                                  s3Key ã‚’ Message ã«å«ã‚ã‚‹
                                           â”‚
                                           â–¼
                                  Agent ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§å‡¦ç†
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### èªè¨¼ãƒ»èªå¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æ–¹å¼ |
|----------|------|
| **Frontend** | Amplify Authenticator (Cognito) |
| **API** | AppSync + Cognito JWT |
| **Storage** | Owner-based Access Control |
| **Lambda** | IAM Role (æœ€å°æ¨©é™) |

### IAM ãƒãƒªã‚·ãƒ¼

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ],
      "Resource": [
        "arn:aws:bedrock:*::foundation-model/amazon.nova-*",
        "arn:aws:bedrock:*::foundation-model/anthropic.claude-*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": ["s3:GetObject", "s3:PutObject"],
      "Resource": "arn:aws:s3:::amplify-*-storage/*"
    }
  ]
}
```

---

## ã‚³ã‚¹ãƒˆæ§‹æˆ

### ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒ (é–‹ç™ºæ™‚)

| ãƒªã‚½ãƒ¼ã‚¹ | æœˆé¡ã‚³ã‚¹ãƒˆ |
|----------|-----------|
| Cognito | ç„¡æ–™ (50,000 MAU ã¾ã§) |
| AppSync | ~$4/æœˆ (100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ) |
| Lambda | ~$0 (ç„¡æ–™æ å†…) |
| S3 | ~$0.50 |
| Bedrock | ä½¿ç”¨é‡èª²é‡‘ |
| **åˆè¨ˆ** | **~$5/æœˆ** |

### æœ¬ç•ªç’°å¢ƒ (è»½è² è·)

| ãƒªã‚½ãƒ¼ã‚¹ | æœˆé¡ã‚³ã‚¹ãƒˆ |
|----------|-----------|
| Cognito | ç„¡æ–™ |
| AppSync | ~$10/æœˆ |
| Lambda | ~$5/æœˆ |
| S3 | ~$2/æœˆ |
| Bedrock | ~$20/æœˆ |
| Amplify Hosting | ~$5/æœˆ |
| **åˆè¨ˆ** | **~$40/æœˆ** |

### ECSæ§‹æˆã¨ã®æ¯”è¼ƒ

| æ§‹æˆ | ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ | è»½è² è· |
|------|-----------|--------|
| **ECS Fargate** | ~$50/æœˆ | ~$100/æœˆ |
| **Amplify Gen2 (æœ¬æ§‹æˆ)** | ~$5/æœˆ | ~$40/æœˆ |

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ (é–‹ç™º)

```bash
cd amplify
npm install
npx ampx sandbox
```

### æœ¬ç•ª (Git Push)

```bash
git push origin main
# â†’ Amplify Hosting ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

### æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npx ampx pipeline-deploy --branch main --app-id $APP_ID
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](../README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- [AMPLIFY_SANDBOX_GUIDE.md](./AMPLIFY_SANDBOX_GUIDE.md) - ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚¬ã‚¤ãƒ‰
- [E2E_TESTING.md](./E2E_TESTING.md) - E2Eãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰
- [DEPLOY.md](../DEPLOY.md) - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
- [TASKS.csv](./TASKS.csv) - ã‚¿ã‚¹ã‚¯ç®¡ç†

---

*Last Updated: 2025-01-01*
*Architecture: Amplify Gen2 + Strands Agent + Bedrock Nova*
