# E2E テストガイド

## 概要

このドキュメントでは、Nova シリーズの全機能をフロントエンド管理画面から実際に試す手順を説明します。

## 前提条件

### 1. バックエンドのデプロイ

```bash
# CDK デプロイ
cd infra
cdk deploy --all --require-approval never
```

デプロイ後、出力される Lambda Function URL をコピーしてください：
```
Outputs:
ComputeStack.AgUiFunctionUrl = https://xxxx.lambda-url.ap-northeast-1.on.aws/
```

### 2. フロントエンドの設定

```bash
cd frontend
npm install
npm run dev
```

ブラウザで http://localhost:3000/settings にアクセスし、Lambda Function URL を設定します。

---

## テストシナリオ

### Phase 1: Nova Omni - Vision（画像解析）

#### テスト 1-1: 画像のキャプション生成

1. `/copilot` ページにアクセス
2. 画像ファイルをアップロード（対応形式: PNG, JPEG, GIF, WEBP）
3. チャットで質問: **「この画像を説明してください」**

**期待される結果:**
- 画像の内容を詳細に説明するテキストが返される
- 物体、色、配置、シーンなどが認識される

#### テスト 1-2: 画像内のテキスト認識（OCR）

1. テキストを含む画像をアップロード（スクリーンショット、文書写真など）
2. 質問: **「この画像のテキストを読み取ってください」**

**期待される結果:**
- 画像内のテキストが正確に抽出される
- 日本語・英語の混在にも対応

#### テスト 1-3: 画像比較分析

1. 複数の画像をアップロード
2. 質問: **「これらの画像の違いを教えてください」**

**期待される結果:**
- 両画像の差異が明確に指摘される

---

### Phase 2: Nova Omni - Video（動画解析）

#### テスト 2-1: 動画のシーン分析

1. 動画ファイルをアップロード（対応形式: MP4, MOV, WEBM）
2. 質問: **「この動画の内容を要約してください」**

**期待される結果:**
- 動画内の主要なシーンが時系列で説明される
- 登場人物、アクション、場所が認識される

#### テスト 2-2: 動画内の特定シーン検索

1. 動画をアップロード
2. 質問: **「〇〇のシーンは何分頃ですか？」**

**期待される結果:**
- 指定したシーンのタイムスタンプが返される

---

### Phase 3: Nova Sonic - Speech（音声処理）

#### テスト 3-1: 音声文字起こし

1. 音声ファイルをアップロード（対応形式: MP3, WAV, FLAC, OGG）
2. 質問: **「この音声を文字起こししてください」**

**期待される結果:**
- 音声内容がテキストとして出力される
- タイムスタンプ付きセグメントが表示される

#### テスト 3-2: 話者識別（Diarization）

1. 複数人の会話音声をアップロード
2. 質問: **「話者を識別して文字起こししてください」**

**期待される結果:**
- 話者ごとに発言が分離される
- Speaker 1, Speaker 2 などのラベルが付与される

#### テスト 3-3: 感情分析

1. 音声ファイルをアップロード
2. 質問: **「この音声の感情を分析してください」**

**期待される結果:**
- 感情（喜び、悲しみ、怒りなど）がスコア付きで表示される
- トーンの変化がタイムラインで表示される

---

### Phase 4: Nova Multimodal Embeddings（ベクトル検索）

#### テスト 4-1: テキストの埋め込み生成

1. チャットで質問: **「次のテキストをベクトル化してください：『AIは未来を変える技術です』」**

**期待される結果:**
- 1024次元のベクトルが生成される
- 正規化されたベクトル値が表示される

#### テスト 4-2: 画像の埋め込み生成

1. 画像をアップロード
2. 質問: **「この画像をベクトル化してください」**

**期待される結果:**
- 画像特徴を表すベクトルが生成される
- テキストベクトルと同じ次元数

#### テスト 4-3: 類似度検索

1. 複数の画像/テキストをアップロード
2. 質問: **「これらの中で最も類似しているものはどれですか？」**

**期待される結果:**
- コサイン類似度に基づく類似度スコアが表示される
- ランキング形式で結果が返される

---

## トラブルシューティング

### 問題: 「設定が必要です」と表示される

**解決策:**
1. `/settings` ページにアクセス
2. Lambda Function URL を入力して保存
3. ページをリロード

### 問題: ファイルアップロードが失敗する

**解決策:**
1. ファイルサイズが 10MB 以下か確認
2. 対応形式のファイルか確認
3. ブラウザの開発者ツールでエラーを確認

### 問題: API エラーが発生する

**解決策:**
1. CloudWatch Logs でエラー詳細を確認
2. Lambda の IAM ロールに Bedrock アクセス権限があるか確認
3. Bedrock モデルへのアクセスが許可されているか確認

---

## テスト結果記録テンプレート

| テストID | 機能 | 入力 | 期待結果 | 実際の結果 | 合否 |
|---------|------|------|---------|-----------|------|
| 1-1 | 画像キャプション | サンプル画像 | 詳細な説明 | | |
| 1-2 | OCR | スクリーンショット | テキスト抽出 | | |
| 2-1 | 動画要約 | サンプル動画 | シーン要約 | | |
| 3-1 | 文字起こし | 音声ファイル | テキスト出力 | | |
| 3-2 | 話者識別 | 会話音声 | 話者分離 | | |
| 4-1 | テキスト埋め込み | テキスト | 1024次元ベクトル | | |
| 4-2 | 画像埋め込み | 画像 | 1024次元ベクトル | | |

---

## 次のステップ

テスト完了後：

1. **テスト結果を `docs/TASKS.csv` に記録**
2. **発見した問題を Issue として登録**
3. **パフォーマンス測定結果を `docs/performance-baseline.md` に追記**

